<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>网页采集系统 - 数据导出</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="lib/layui-v2.6.3/css/layui.css">
    <link rel="stylesheet" href="css/common.css">
    <style>
        /* 全局样式优化 */
        body {
            background-color: #f5f7fa;
            font-family: "Microsoft YaHei", "Roboto", sans-serif;
        }
        .layui-layout-admin .layui-header {
            background: linear-gradient(135deg, #1E9FFF 0%, #0A6EFF 100%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .layui-logo {
            background: rgba(255, 255, 255, 0.15) !important;
            border-radius: 0 4px 4px 0;
            font-size: 18px;
            letter-spacing: 1px;
        }
        .layui-nav-tree .layui-nav-itemed > a {
            background-color: #e6f7ff !important;
            color: #1E9FFF !important;
            border-left: 3px solid #1E9FFF;
        }
        .layui-body {
            background-color: #f5f7fa;
            padding: 20px;
        }

        /* 卡片容器样式 */
        .card-container {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 20px;
        }
        .card-title {
            font-size: 18px;
            font-weight: 500;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f2f2f2;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .card-title i {
            color: #1E9FFF;
            margin-right: 10px;
            font-size: 20px;
        }
        .title-text {
            display: flex;
            align-items: center;
        }
        .title-actions {
            display: flex;
            gap: 10px;
        }

        /* 按钮样式优化 */
        .layui-btn {
            border-radius: 4px;
            padding: 0 18px;
            height: 36px;
            line-height: 36px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .layui-btn i {
            margin-right: 6px;
        }
        .layui-btn-primary:hover {
            border-color: #1E9FFF;
            color: #1E9FFF;
        }
        .layui-btn-normal {
            background-color: #1E9FFF;
        }
        .layui-btn-normal:hover {
            background-color: #0A6EFF;
        }
        .layui-btn-danger:hover {
            background-color: #e53e3e;
        }
        .layui-btn-success {
            background-color: #52C41A;
        }
        .layui-btn-success:hover {
            background-color: #4CAF50;
        }
        .btn-large {
            padding: 0 24px;
            height: 42px;
            line-height: 42px;
            font-size: 16px;
        }

        /* 数据统计卡片 */
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            flex: 1;
            min-width: 200px;
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .stat-title {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .stat-title i {
            margin-right: 8px;
            font-size: 16px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }
        .stat-meta {
            font-size: 12px;
            color: #888;
        }

        /* 导出设置区域 */
        .export-settings {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 30px;
        }
        .settings-column {
            flex: 1;
            min-width: 300px;
        }
        .settings-group {
            margin-bottom: 25px;
        }
        .settings-title {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .settings-title i {
            color: #1E9FFF;
            margin-right: 8px;
        }
        .layui-form-item {
            margin-bottom: 18px;
        }
        .layui-form-label {
            width: 110px;
            padding: 9px 15px;
            color: #666;
        }
        .layui-input-block {
            margin-left: 140px;
        }
        .field-checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .field-checkbox-item {
            display: flex;
            align-items: center;
        }
        .field-checkbox-item input {
            margin-right: 5px;
        }
        .date-range {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .date-range input {
            width: 50%;
        }
        .range-text {
            color: #999;
            white-space: nowrap;
        }

        /* 导出按钮区域 */
        .export-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* 导出历史表格 */
        .history-table-container {
            overflow-x: auto;
        }
        .layui-table {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            width: 100%;
        }
        .layui-table th {
            background-color: #f7fafc;
            color: #666;
            font-weight: 500;
            white-space: nowrap;
        }
        .layui-table tr:hover {
            background-color: #f7fafc;
        }
        .layui-table td, .layui-table th {
            padding: 12px 15px;
            vertical-align: middle;
        }
        .table-actions {
            display: flex;
            gap: 8px;
        }
        .table-action-btn {
            color: #1E9FFF;
            cursor: pointer;
            font-size: 14px;
            transition: color 0.2s;
            display: inline-flex;
            align-items: center;
        }
        .table-action-btn i {
            margin-right: 4px;
        }
        .table-action-btn:hover {
            color: #0A6EFF;
        }
        .table-action-btn.danger {
            color: #F5222D;
        }
        .table-action-btn.danger:hover {
            color: #e53e3e;
        }

        /* 状态标签样式 */
        .status-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-success {
            background-color: #f6ffed;
            color: #52C41A;
            border: 1px solid #e1f3d8;
        }
        .status-processing {
            background-color: #e6f7ff;
            color: #1890ff;
            border: 1px solid #bae7ff;
        }
        .status-failed {
            background-color: #fff2f0;
            color: #F5222D;
            border: 1px solid #ffe3e3;
        }

        /* 文件大小和进度 */
        .file-size {
            color: #666;
            font-size: 13px;
        }
        .progress-container {
            width: 100%;
            height: 6px;
            background-color: #f0f2f5;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        .progress-success {
            background-color: #52C41A;
        }
        .progress-processing {
            background-color: #1E9FFF;
        }
        .progress-failed {
            background-color: #F5222D;
        }

        /* 分页样式 */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .page-info {
            color: #666;
            font-size: 14px;
        }

        /* 空状态样式 */
        .empty-state {
            text-align: center;
            padding: 60px 0;
            color: #888;
        }
        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #ddd;
        }
        .empty-state p {
            margin-bottom: 20px;
            font-size: 16px;
        }

        /* 导出成功提示 */
        .export-success-modal {
            text-align: center;
            padding: 20px 0;
        }
        .success-icon {
            font-size: 60px;
            color: #52C41A;
            margin-bottom: 20px;
        }
        .success-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 10px;
        }
        .success-message {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* 响应式优化 */
        @media screen and (max-width: 768px) {
            .stats-container {
                flex-direction: column;
            }
            .stat-card {
                width: 100%;
            }
            .export-settings {
                flex-direction: column;
            }
            .settings-column {
                width: 100%;
            }
            .layui-form-label {
                width: 90px;
                padding: 9px 10px;
            }
            .layui-input-block {
                margin-left: 120px;
            }
            .date-range {
                flex-direction: column;
                align-items: flex-start;
            }
            .date-range input {
                width: 100%;
            }
            .export-actions {
                flex-direction: column;
            }
            .table-actions {
                flex-wrap: wrap;
            }
            .table-action-btn {
                margin-bottom: 5px;
            }
        }

        @media screen and (max-width: 480px) {
            .layui-form-label {
                width: 100%;
                display: block;
            }
            .layui-input-block {
                margin-left: 0;
                margin-top: 5px;
            }
            .field-checkbox-group {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <!-- 顶部导航 -->
        <div class="layui-header">
            <div class="layui-logo">网页采集系统</div>
            <ul class="layui-nav layui-layout-left">
                <li class="layui-nav-item"><a href="index.html">首页</a></li>
                <li class="layui-nav-item"><a href="task-config.html">任务配置</a></li>
                <li class="layui-nav-item"><a href="crawl-rules.html">采集规则</a></li>
                <li class="layui-nav-item"><a href="task-management.html">任务管理</a></li>
                <li class="layui-nav-item"><a href="data-preview.html">数据预览</a></li>
                <li class="layui-nav-item layui-nav-itemed"><a href="data-export.html">数据导出</a></li>
                <li class="layui-nav-item"><a href="system-settings.html">系统设置</a></li>
                <li class="layui-nav-item"><a href="log-view.html">日志查看</a></li>
            </ul>
            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <img src="lib/layui-v2.6.3/images/face.jpg" class="layui-nav-img" style="border-radius: 50%;">
                        管理员
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">个人中心</a></dd>
                        <dd><a href="javascript:;">修改密码</a></dd>
                        <dd><a href="login.html">退出登录</a></dd>
                    </dl>
                </li>
            </ul>
        </div>

        <!-- 侧边栏 -->
        <div class="layui-side">
            <div class="layui-side-scroll">
                <ul class="layui-nav layui-nav-tree" lay-filter="sideNav">
                    <li class="layui-nav-item">
                        <a href="index.html"><i class="fa fa-home"></i> 系统首页</a>
                    </li>
                    <li class="layui-nav-item">
                        <a href="task-config.html"><i class="fa fa-cog"></i> 任务配置</a>
                    </li>
                    <li class="layui-nav-item">
                        <a href="crawl-rules.html"><i class="fa fa-filter"></i> 采集规则</a>
                    </li>
                    <li class="layui-nav-item">
                        <a href="task-management.html"><i class="fa fa-tasks"></i> 任务管理</a>
                    </li>
                    <li class="layui-nav-item">
                        <a href="data-preview.html"><i class="fa fa-table"></i> 数据预览</a>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="data-export.html"><i class="fa fa-download"></i> 数据导出</a>
                    </li>
                    <li class="layui-nav-item">
                        <a href="system-settings.html"><i class="fa fa-sliders"></i> 系统设置</a>
                    </li>
                    <li class="layui-nav-item">
                        <a href="log-view.html"><i class="fa fa-history"></i> 日志查看</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 主内容区 -->
        <div class="layui-body">
            <!-- 数据统计卡片 -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="layui-icon layui-icon-database"></i>
                        可导出数据总量
                    </div>
                    <div class="stat-value">12,586</div>
                    <div class="stat-meta">条记录</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="layui-icon layui-icon-file-excel"></i>
                        今日导出次数
                    </div>
                    <div class="stat-value">18</div>
                    <div class="stat-meta">次导出操作</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="layui-icon layui-icon-file-zip"></i>
                        今日导出数据量
                    </div>
                    <div class="stat-value">3.2 GB</div>
                    <div class="stat-meta">总导出大小</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="layui-icon layui-icon-clock"></i>
                        最近导出时间
                    </div>
                    <div class="stat-value">15:32</div>
                    <div class="stat-meta">今天 15:32:47</div>
                </div>
            </div>

            <!-- 导出设置卡片 -->
            <div class="card-container">
                <div class="card-title">
                    <div class="title-text">
                        <i class="layui-icon layui-icon-download-circle"></i>
                        数据导出设置
                    </div>
                    <div class="title-actions">
                        <button class="layui-btn layui-btn-primary" id="resetExportSettings">
                            <i class="layui-icon layui-icon-refresh"></i> 重置设置
                        </button>
                    </div>
                </div>

                <form class="layui-form" lay-filter="exportForm">
                    <div class="export-settings">
                        <div class="settings-column">
                            <div class="settings-group">
                                <div class="settings-title">
                                    <i class="layui-icon layui-icon-tasks"></i>
                                    数据来源
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">关联任务</label>
                                    <div class="layui-input-block">
                                        <select name="taskId" lay-filter="taskFilter">
                                            <option value="">全部任务</option>
                                            <option value="1">新闻网站采集</option>
                                            <option value="2">电商价格监控</option>
                                            <option value="3">社交媒体评论采集</option>
                                            <option value="4">论坛帖子采集</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">采集规则</label>
                                    <div class="layui-input-block">
                                        <select name="ruleId" lay-filter="ruleFilter">
                                            <option value="">全部规则</option>
                                            <option value="1">通用网页内容采集</option>
                                            <option value="2">新闻文章采集</option>
                                            <option value="3">电商产品信息采集</option>
                                            <option value="4">社交媒体评论采集</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">时间范围</label>
                                    <div class="layui-input-block">
                                        <div class="date-range">
                                            <input type="text" name="startDate" class="layui-input" placeholder="开始日期">
                                            <span class="range-text">至</span>
                                            <input type="text" name="endDate" class="layui-input" placeholder="结束日期">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <div class="settings-title">
                                    <i class="layui-icon layui-icon-filter"></i>
                                    高级筛选
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">包含关键词</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="keywords" placeholder="多个关键词用逗号分隔" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">排除关键词</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="excludeKeywords" placeholder="多个关键词用逗号分隔" class="layui-input">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-column">
                            <div class="settings-group">
                                <div class="settings-title">
                                    <i class="layui-icon layui-icon-list"></i>
                                    导出字段选择
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">选择字段</label>
                                    <div class="layui-input-block">
                                        <div class="field-checkbox-group">
                                            <div class="field-checkbox-item">
                                                <input type="checkbox" name="fields" lay-skin="primary" title="ID" value="id" checked>
                                            </div>
                                            <div class="field-checkbox-item">
                                                <input type="checkbox" name="fields" lay-skin="primary" title="标题" value="title" checked>
                                            </div>
                                            <div class="field-checkbox-item">
                                                <input type="checkbox" name="fields" lay-skin="primary" title="内容" value="content" checked>
                                            </div>
                                            <div class="field-checkbox-item">
                                                <input type="checkbox" name="fields" lay-skin="primary" title="来源URL" value="url" checked>
                                            </div>
                                            <div class="field-checkbox-item">
                                                <input type="checkbox" name="fields" lay-skin="primary" title="作者" value="author">
                                            </div>
                                            <div class="field-checkbox-item">
                                                <input type="checkbox" name="fields" lay-skin="primary" title="发布时间" value="publishTime" checked>
                                            </div>
                                            <div class="field-checkbox-item">
                                                <input type="checkbox" name="fields" lay-skin="primary" title="采集时间" value="crawlTime" checked>
                                            </div>
                                            <div class="field-checkbox-item">
                                                <input type="checkbox" name="fields" lay-skin="primary" title="关联任务" value="taskName">
                                            </div>
                                            <div class="field-checkbox-item">
                                                <input type="checkbox" name="fields" lay-skin="primary" title="图片URL" value="imageUrls">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-group">
                                <div class="settings-title">
                                    <i class="layui-icon layui-icon-file"></i>
                                    导出格式设置
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">文件格式</label>
                                    <div class="layui-input-block">
                                        <select name="fileFormat" lay-filter="fileFormat">
                                            <option value="excel">Excel (.xlsx)</option>
                                            <option value="csv">CSV (.csv)</option>
                                            <option value="json">JSON (.json)</option>
                                            <option value="xml">XML (.xml)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">包含图片</label>
                                    <div class="layui-input-block">
                                        <input type="radio" name="includeImages" value="0" title="不包含" checked>
                                        <input type="radio" name="includeImages" value="1" title="仅URL">
                                        <input type="radio" name="includeImages" value="2" title="下载图片">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">压缩文件</label>
                                    <div class="layui-input-block">
                                        <input type="checkbox" name="compressFile" lay-skin="switch" lay-text="是|否">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">文件名称</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="fileName" placeholder="自定义导出文件名称" class="layui-input" value="采集数据导出_{date}">
                                        <div class="layui-form-mid layui-word-aux">可使用{date}表示当前日期，{task}表示任务名称</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="export-actions">
                        <button type="button" class="layui-btn layui-btn-primary btn-large" id="previewExportData">
                            <i class="layui-icon layui-icon-eye"></i> 预览导出数据
                        </button>
                        <button type="button" class="layui-btn layui-btn-normal btn-large" id="startExportBtn">
                            <i class="layui-icon layui-icon-download"></i> 开始导出
                        </button>
                    </div>
                </form>
            </div>

            <!-- 导出历史卡片 -->
            <div class="card-container">
                <div class="card-title">
                    <div class="title-text">
                        <i class="layui-icon layui-icon-history"></i>
                        导出历史记录
                    </div>
                    <div class="title-actions">
                        <button class="layui-btn layui-btn-primary" id="refreshHistoryBtn">
                            <i class="layui-icon layui-icon-refresh"></i> 刷新记录
                        </button>
                        <button class="layui-btn layui-btn-danger" id="clearHistoryBtn">
                            <i class="layui-icon layui-icon-delete"></i> 清空历史
                        </button>
                    </div>
                </div>

                <!-- 导出历史表格 -->
                <div class="history-table-container">
                    <table class="layui-table" lay-size="sm" id="exportHistoryTable">
                        <thead>
                            <tr>
                                <th style="width: 60px;">ID</th>
                                <th>文件名称</th>
                                <th>关联任务</th>
                                <th>文件格式</th>
                                <th>数据量</th>
                                <th>文件大小</th>
                                <th>导出状态</th>
                                <th>导出进度</th>
                                <th>导出时间</th>
                                <th style="width: 160px;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>501</td>
                                <td>采集数据导出_202405101532</td>
                                <td>新闻网站采集</td>
                                <td>Excel</td>
                                <td>1,256 条</td>
                                <td class="file-size">2.4 MB</td>
                                <td><span class="status-tag status-success">导出成功</span></td>
                                <td>
                                    <div class="progress-container">
                                        <div class="progress-bar progress-success" style="width: 100%;"></div>
                                    </div>
                                </td>
                                <td>2024-05-10 15:32:47</td>
                                <td>
                                    <div class="table-actions">
                                        <span class="table-action-btn download-file" data-id="501">
                                            <i class="layui-icon layui-icon-download"></i> 下载
                                        </span>
                                        <span class="table-action-btn view-details" data-id="501">
                                            <i class="layui-icon layui-icon-eye"></i> 详情
                                        </span>
                                        <span class="table-action-btn danger delete-history" data-id="501">
                                            <i class="layui-icon layui-icon-delete"></i> 删除
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>500</td>
                                <td>电商数据_202405101420</td>
                                <td>电商价格监控</td>
                                <td>CSV</td>
                                <td>3,582 条</td>
                                <td class="file-size">1.8 MB</td>
                                <td><span class="status-tag status-success">导出成功</span></td>
                                <td>
                                    <div class="progress-container">
                                        <div class="progress-bar progress-success" style="width: 100%;"></div>
                                    </div>
                                </td>
                                <td>2024-05-10 14:20:15</td>
                                <td>
                                    <div class="table-actions">
                                        <span class="table-action-btn download-file" data-id="500">
                                            <i class="layui-icon layui-icon-download"></i> 下载
                                        </span>
                                        <span class="table-action-btn view-details" data-id="500">
                                            <i class="layui-icon layui-icon-eye"></i> 详情
                                        </span>
                                        <span class="table-action-btn danger delete-history" data-id="500">
                                            <i class="layui-icon layui-icon-delete"></i> 删除
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>499</td>
                                <td>社交媒体评论数据</td>
                                <td>社交媒体评论采集</td>
                                <td>JSON</td>
                                <td>5,247 条</td>
                                <td class="file-size">4.7 MB</td>
                                <td><span class="status-tag status-processing">处理中</span></td>
                                <td>
                                    <div class="progress-container">
                                        <div class="progress-bar progress-processing" style="width: 68%;"></div>
                                    </div>
                                </td>
                                <td>2024-05-10 15:10:32</td>
                                <td>
                                    <div class="table-actions">
                                        <span class="table-action-btn danger cancel-export" data-id="499">
                                            <i class="layui-icon layui-icon-stop"></i> 取消
                                        </span>
                                        <span class="table-action-btn view-details" data-id="499">
                                            <i class="layui-icon layui-icon-eye"></i> 详情
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>498</td>
                                <td>论坛帖子数据_20240510</td>
                                <td>论坛帖子采集</td>
                                <td>Excel</td>
                                <td>2,874 条</td>
                                <td class="file-size">0 MB</td>
                                <td><span class="status-tag status-failed">导出失败</span></td>
                                <td>
                                    <div class="progress-container">
                                        <div class="progress-bar progress-failed" style="width: 35%;"></div>
                                    </div>
                                </td>
                                <td>2024-05-10 13:45:22</td>
                                <td>
                                    <div class="table-actions">
                                        <span class="table-action-btn retry-export" data-id="498">
                                            <i class="layui-icon layui-icon-refresh"></i> 重试
                                        </span>
                                        <span class="table-action-btn view-details" data-id="498">
                                            <i class="layui-icon layui-icon-eye"></i> 详情
                                        </span>
                                        <span class="table-action-btn danger delete-history" data-id="498">
                                            <i class="layui-icon layui-icon-delete"></i> 删除
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 分页 -->
                <div class="pagination-container">
                    <div class="page-info">显示 1 到 4 条，共 42 条</div>
                    <div class="layui-box layui-laypage layui-laypage-default" id="historyPage">
                        <a class="layui-laypage-prev layui-disabled">上一页</a>
                        <span class="layui-laypage-curr"><em class="layui-laypage-em"></em><em>1</em></span>
                        <a href="javascript:;">2</a>
                        <a href="javascript:;">3</a>
                        <span class="layui-laypage-spr">…</span>
                        <a href="javascript:;">11</a>
                        <a class="layui-laypage-next">下一页</a>
                    </div>
                </div>
            </div>
        </div>
		
    </div>

    <!-- 导出成功弹窗 -->
    <div class="layui-modal" id="exportSuccessModal" style="display: none; width: 500px; max-width: 90%;">
        <div class="layui-modal-title">导出成功</div>
        <div class="layui-modal-body" style="padding: 0;">
            <div class="export-success-modal">
                <div class="success-icon">
                    <i class="layui-icon layui-icon-ok-circle"></i>
                </div>
                <div class="success-title">数据导出任务已创建成功</div>
                <div class="success-message">
                    您的导出任务已开始处理，ID：<strong id="exportTaskId">502</strong><br>
                    数据量：<strong id="exportDataCount">2,458</strong> 条<br>
                    预计完成时间：<strong id="exportEstimateTime">约 1 分钟</strong>
                </div>
                <div>
                    <button class="layui-btn layui-btn-normal" id="gotoHistoryBtn">
                        <i class="layui-icon layui-icon-history"></i> 查看导出历史
                    </button>
                </div>
            </div>
        </div>
        <div class="layui-modal-footer" style="display: none;">
            <button type="button" class="layui-btn layui-btn-primary" id="closeSuccessModal">关闭</button>
        </div>
    </div>

    <!-- 导出确认弹窗 -->
    <div class="layui-modal" id="exportConfirmModal" style="display: none;">
        <div class="layui-modal-title">确认导出</div>
        <div class="layui-modal-body" style="padding: 20px;">
            <p style="margin-bottom: 15px; line-height: 1.6;">
                根据您的设置，系统将导出以下数据：
            </p>
            <ul class="layui-form" style="padding-left: 20px; line-height: 1.8; color: #666; margin-bottom: 10px;">
                <li><strong>关联任务：</strong><span id="confirmTaskName">全部任务</span></li>
                <li><strong>时间范围：</strong><span id="confirmTimeRange">全部时间</span></li>
                <li><strong>数据量：</strong><span id="confirmDataCount">约 3,582 条</span></li>
                <li><strong>文件格式：</strong><span id="confirmFileFormat">Excel (.xlsx)</span></li>
                <li><strong>包含图片：</strong><span id="confirmIncludeImages">不包含</span></li>
            </ul>
            <p style="color: #F5222D; font-size: 14px;">
                <i class="layui-icon layui-icon-warning"></i>
                提示：大量数据导出可能需要较长时间，请耐心等待
            </p>
        </div>
        <div class="layui-modal-footer">
            <button type="button" class="layui-btn layui-btn-primary" id="cancelExport">取消</button>
            <button type="button" class="layui-btn layui-btn-normal" id="confirmExportBtn">
                <i class="layui-icon layui-icon-download"></i> 确认导出
            </button>
        </div>
    </div>

    <!-- 清空历史确认弹窗 -->
    <div class="layui-modal" id="clearHistoryConfirmModal" style="display: none;">
        <div class="layui-modal-title">确认清空</div>
        <div class="layui-modal-body" style="padding: 20px;">
            <p style="color: #F5222D; font-size: 16px; text-align: center; padding: 10px 0;">
                <i class="layui-icon layui-icon-warning" style="font-size: 20px; margin-right: 8px;"></i>
                确定要清空所有导出历史记录吗？
            </p>
            <p style="color: #666; text-align: center;">此操作不可恢复，所有导出记录将被永久删除！</p>
        </div>
        <div class="layui-modal-footer">
            <button type="button" class="layui-btn layui-btn-primary" id="cancelClearHistory">取消</button>
            <button type="button" class="layui-btn layui-btn-danger" id="confirmClearHistory">
                <i class="layui-icon layui-icon-delete"></i> 确认清空
            </button>
        </div>
    </div>

    <script src="lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
    <script src="lib/layui-v2.6.3/layui.js"></script>
    <script>
        layui.use(['element', 'layer', 'form', 'laypage', 'laydate'], function(){
            var element = layui.element;
            var layer = layui.layer;
            var form = layui.form;
            var laypage = layui.laypage;
            var laydate = layui.laydate;
            var $ = layui.$;

            // 验证登录状态
            if(localStorage.getItem('isLogin')){
                layer.msg('请先登录', {icon: 2}, function(){
                    window.location.href = 'login.html';
                });
            }

            // 初始化日期选择器
            laydate.render({
                elem: 'input[name="startDate"]',
                format: 'yyyy-MM-dd'
            });
            laydate.render({
                elem: 'input[name="endDate"]',
                format: 'yyyy-MM-dd'
            });

            // 分页渲染
            laypage.render({
                elem: 'historyPage',
                count: 42,
                limit: 4,
                curr: 1,
                layout: ['prev', 'page', 'next', 'count'],
                jump: function(obj, first){
                    if(!first){
                        layer.msg('切换到第' + obj.curr + '页', {icon: 0});
                        // 模拟加载数据
                        refreshExportHistory(false);
                    }
                }
            });

            // 重置导出设置
            $('#resetExportSettings').click(function(){
                layer.confirm('确定要重置所有导出设置为默认值吗？', {
                    icon: 3,
                    title: '重置设置'
                }, function(index){
                    layer.close(index);
                    
                    // 重置表单
                    $('select[name="taskId"]').val('');
                    $('select[name="ruleId"]').val('');
                    $('input[name="startDate"]').val('');
                    $('input[name="endDate"]').val('');
                    $('input[name="keywords"]').val('');
                    $('input[name="excludeKeywords"]').val('');
                    
                    // 重置字段选择
                    $('input[name="fields"]').prop('checked', false);
                    $('input[name="fields"][value="id"]').prop('checked', true);
                    $('input[name="fields"][value="title"]').prop('checked', true);
                    $('input[name="fields"][value="content"]').prop('checked', true);
                    $('input[name="fields"][value="url"]').prop('checked', true);
                    $('input[name="fields"][value="publishTime"]').prop('checked', true);
                    $('input[name="fields"][value="crawlTime"]').prop('checked', true);
                    
                    // 重置格式设置
                    $('select[name="fileFormat"]').val('excel');
                    $('input[name="includeImages"][value="0"]').prop('checked', true);
                    $('input[name="compressFile"]').prop('checked', false);
                    $('input[name="fileName"]').val('采集数据导出_{date}');
                    
                    // 重新渲染表单
                    form.render();
                    
                    layer.msg('导出设置已重置为默认值', {icon: 1});
                });
            });

            // 预览导出数据
            $('#previewExportData').click(function(){
                // 显示加载动画
                layer.load(2);
                
                // 模拟预览数据加载
                setTimeout(function(){
                    layer.closeAll('loading');
                    window.location.href = 'data-preview.html';
                }, 800);
            });

            // 开始导出按钮点击
            $('#startExportBtn').click(function(){
                // 获取当前设置
                var taskId = $('select[name="taskId"]').val();
                var taskName = taskId ? $('select[name="taskId"] option:selected').text() : '全部任务';
                var startDate = $('input[name="startDate"]').val();
                var endDate = $('input[name="endDate"]').val();
                var fileFormat = $('select[name="fileFormat"]').val();
                var formatText = $('select[name="fileFormat"] option:selected').text();
                var includeImages = $('input[name="includeImages"]:checked').val();
                var imageText = '';
                
                // 处理图片选项文本
                switch(includeImages) {
                    case '0': imageText = '不包含'; break;
                    case '1': imageText = '仅URL'; break;
                    case '2': imageText = '下载图片'; break;
                }
                
                // 处理时间范围文本
                var timeRangeText = '全部时间';
                if(startDate && endDate) {
                    timeRangeText = startDate + ' 至 ' + endDate;
                } else if(startDate) {
                    timeRangeText = startDate + ' 至今';
                } else if(endDate) {
                    timeRangeText = '至 ' + endDate;
                }
                
                // 估算数据量（实际应用中应从服务器获取）
                var dataCount = Math.floor(Math.random() * 3000) + 500;
                var dataCountText = '约 ' + dataCount.toLocaleString() + ' 条';
                
                // 填充确认弹窗
                $('#confirmTaskName').text(taskName);
                $('#confirmTimeRange').text(timeRangeText);
                $('#confirmDataCount').text(dataCountText);
                $('#confirmFileFormat').text(formatText);
                $('#confirmIncludeImages').text(imageText);
                
                // 显示确认弹窗
                $('#exportConfirmModal').css('display', 'block');
                setTimeout(function(){
                    $('#exportConfirmModal').addClass('layui-anim layui-anim-up');
                }, 10);
            });

            // 关闭导出确认弹窗
            $('#cancelExport').click(function(){
                $('#exportConfirmModal').removeClass('layui-anim layui-anim-up');
                setTimeout(function(){
                    $('#exportConfirmModal').css('display', 'none');
                }, 300);
            });

            // 确认导出
            $('#confirmExportBtn').click(function(){
                // 关闭确认弹窗
                $('#exportConfirmModal').removeClass('layui-anim layui-anim-up');
                setTimeout(function(){
                    $('#exportConfirmModal').css('display', 'none');
                }, 300);
                
                // 显示加载动画
                layer.load(2);
                
                // 模拟导出处理
                setTimeout(function(){
                    layer.closeAll('loading');
                    
                    // 生成随机任务ID
                    var taskId = Math.floor(Math.random() * 1000);
                    var dataCount = $('#confirmDataCount').text();
                    
                    // 估算完成时间（根据数据量）
                    var estimateTime = '约 1 分钟';
                    if(dataCount.indexOf('5,000') > -1) {
                        estimateTime = '约 3-5 分钟';
                    } else if(dataCount.indexOf('10,000') > -1) {
                        estimateTime = '约 10 分钟';
                    }
                    
                    // 填充成功弹窗
                    $('#exportTaskId').text(taskId);
                    $('#exportDataCount').text(dataCount.replace('约 ', ''));
                    $('#exportEstimateTime').text(estimateTime);
                    
                    // 显示成功弹窗
                    $('#exportSuccessModal').css('display', 'block');
                    setTimeout(function(){
                        $('#exportSuccessModal').addClass('layui-anim layui-anim-up');
                    }, 10);
                    
                    // 刷新导出历史
                    refreshExportHistory();
                }, 1500);
            });

            // 关闭成功弹窗
            $('#closeSuccessModal, #gotoHistoryBtn').click(function(){
                $('#exportSuccessModal').removeClass('layui-anim layui-anim-up');
                setTimeout(function(){
                    $('#exportSuccessModal').css('display', 'none');
                    
                    // 如果是点击查看历史按钮，滚动到历史记录区域
                    if($(this).attr('id') === 'gotoHistoryBtn') {
                        $('html, body').animate({
                            scrollTop: $('#exportHistoryTable').offset().top - 100
                        }, 500);
                    }
                }, 300);
            });

            // 刷新导出历史
            $('#refreshHistoryBtn').click(function(){
                refreshExportHistory();
            });

            // 清空历史记录
            $('#clearHistoryBtn').click(function(){
                // 显示确认弹窗
                $('#clearHistoryConfirmModal').css('display', 'block');
                setTimeout(function(){
                    $('#clearHistoryConfirmModal').addClass('layui-anim layui-anim-up');
                }, 10);
            });

            // 取消清空历史
            $('#cancelClearHistory').click(function(){
                $('#clearHistoryConfirmModal').removeClass('layui-anim layui-anim-up');
                setTimeout(function(){
                    $('#clearHistoryConfirmModal').css('display', 'none');
                }, 300);
            });

            // 确认清空历史
            $('#confirmClearHistory').click(function(){
                // 关闭确认弹窗
                $('#clearHistoryConfirmModal').removeClass('layui-anim layui-anim-up');
                setTimeout(function(){
                    $('#clearHistoryConfirmModal').css('display', 'none');
                }, 300);
                
                // 显示加载动画
                layer.load(2);
                
                // 模拟清空操作
                setTimeout(function(){
                    layer.closeAll('loading');
                    
                    // 清空表格
                    $('#exportHistoryTable tbody').html(`
                        <tr>
                            <td colspan="10" class="empty-state">
                                <i class="layui-icon layui-icon-empty"></i>
                                <p>暂无导出历史记录</p>
                                <button class="layui-btn layui-btn-primary" id="goToExportBtn">
                                    <i class="layui-icon layui-icon-download"></i> 去导出数据
                                </button>
                            </td>
                        </tr>
                    `);
                    
                    // 绑定去导出按钮事件
                    $('#goToExportBtn').click(function(){
                        $('html, body').animate({
                            scrollTop: $('.export-settings').offset().top - 100
                        }, 500);
                    });
                    
                    layer.msg('所有导出历史记录已清空', {icon: 1});
                }, 1000);
            });

            // 下载文件
            $(document).on('click', '.download-file', function(){
                var fileId = $(this).data('id');
                var fileName = $(this).closest('tr').find('td:eq(1)').text();
                
                // 显示加载动画
                layer.load(2);
                
                // 模拟下载操作
                setTimeout(function(){
                    layer.closeAll('loading');
                    layer.msg('文件《' + fileName + '》开始下载', {icon: 1});
                }, 800);
            });

            // 查看导出详情
            $(document).on('click', '.view-details', function(){
                var exportId = $(this).data('id');
                var fileName = $(this).closest('tr').find('td:eq(1)').text();
                
                // 模拟加载详情
                layer.load(2);
                setTimeout(function(){
                    layer.closeAll('loading');
                    
                    // 显示详情弹窗
                    layer.open({
                        type: 1,
                        title: '导出详情 - ' + fileName,
                        area: ['600px', '450px'],
                        maxWidth: '90%',
                        content: `
                            <div style="padding: 20px;">
                                <table class="layui-table" lay-size="sm">
                                    <tbody>
                                        <tr>
                                            <td style="width: 30%; font-weight: 500;">导出ID</td>
                                            <td>${exportId}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 500;">文件名称</td>
                                            <td>${fileName}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 500;">关联任务</td>
                                            <td>${$(this).closest('tr').find('td:eq(2)').text()}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 500;">文件格式</td>
                                            <td>${$(this).closest('tr').find('td:eq(3)').text()}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 500;">数据量</td>
                                            <td>${$(this).closest('tr').find('td:eq(4)').text()}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 500;">文件大小</td>
                                            <td>${$(this).closest('tr').find('td:eq(5)').text()}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 500;">导出状态</td>
                                            <td>${$(this).closest('tr').find('td:eq(6)').html()}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 500;">导出时间</td>
                                            <td>${$(this).closest('tr').find('td:eq(8)').text()}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 500;">导出用户</td>
                                            <td>管理员</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        `,
                        btn: ['关闭'],
                        btn1: function(index, layero){
                            layer.close(index);
                        }
                    });
                }, 600);
            });

            // 删除历史记录
            $(document).on('click', '.delete-history', function(){
                var exportId = $(this).data('id');
                var fileName = $(this).closest('tr').find('td:eq(1)').text();
                var $tr = $(this).closest('tr');
                
                layer.confirm('确定要删除导出记录《' + fileName + '》吗？', {
                    icon: 3,
                    title: '删除记录'
                }, function(index){
                    layer.close(index);
                    
                    // 显示加载动画
                    layer.load(2);
                    
                    // 模拟删除操作
                    setTimeout(function(){
                        layer.closeAll('loading');
                        $tr.remove();
                        layer.msg('导出记录已删除', {icon: 1});
                        
                        // 检查是否还有记录
                        if($('#exportHistoryTable tbody tr').length === 0){
                            $('#exportHistoryTable tbody').html(`
                                <tr>
                                    <td colspan="10" class="empty-state">
                                        <i class="layui-icon layui-icon-empty"></i>
                                        <p>暂无导出历史记录</p>
                                        <button class="layui-btn layui-btn-primary" id="goToExportBtn">
                                            <i class="layui-icon layui-icon-download"></i> 去导出数据
                                        </button>
                                    </td>
                                </tr>
                            `);
                            
                            // 绑定去导出按钮事件
                            $('#goToExportBtn').click(function(){
                                $('html, body').animate({
                                    scrollTop: $('.export-settings').offset().top - 100
                                }, 500);
                            });
                        }
                    }, 600);
                });
            });

            // 取消导出
            $(document).on('click', '.cancel-export', function(){
                var exportId = $(this).data('id');
                var fileName = $(this).closest('tr').find('td:eq(1)').text();
                
                layer.confirm('确定要取消正在处理的导出任务《' + fileName + '》吗？', {
                    icon: 3,
                    title: '取消导出'
                }, function(index){
                    layer.close(index);
                    
                    // 显示加载动画
                    layer.load(2);
                    
                    // 模拟取消操作
                    setTimeout(function(){
                        layer.closeAll('loading');
                        
                        // 更新状态为已取消
                        var $tr = $(`.cancel-export[data-id="${exportId}"]`).closest('tr');
                        $tr.find('.status-tag').removeClass('status-processing').addClass('status-failed').text('已取消');
                        $tr.find('.progress-bar').removeClass('progress-processing').addClass('progress-failed');
                        
                        // 更新操作按钮
                        var actionsHtml = `
                            <div class="table-actions">
                                <span class="table-action-btn retry-export" data-id="${exportId}">
                                    <i class="layui-icon layui-icon-refresh"></i> 重试
                                </span>
                                <span class="table-action-btn view-details" data-id="${exportId}">
                                    <i class="layui-icon layui-icon-eye"></i> 详情
                                </span>
                                <span class="table-action-btn danger delete-history" data-id="${exportId}">
                                    <i class="layui-icon layui-icon-delete"></i> 删除
                                </span>
                            </div>
                        `;
                        $tr.find('td:last-child').html(actionsHtml);
                        
                        layer.msg('导出任务已取消', {icon: 1});
                    }, 800);
                });
            });

            // 重试导出
            $(document).on('click', '.retry-export', function(){
                var exportId = $(this).data('id');
                var fileName = $(this).closest('tr').find('td:eq(1)').text();
                
                // 显示加载动画
                layer.load(2);
                
                // 模拟重试操作
                setTimeout(function(){
                    layer.closeAll('loading');
                    
                    // 更新状态为处理中
                    var $tr = $(`.retry-export[data-id="${exportId}"]`).closest('tr');
                    $tr.find('.status-tag').removeClass('status-failed').addClass('status-processing').text('处理中');
                    $tr.find('.progress-bar').removeClass('progress-failed').addClass('progress-processing').css('width', '15%');
                    
                    // 更新导出时间为当前时间
                    var now = new Date();
                    var exportTime = now.getFullYear() + '-' + 
                                   (now.getMonth()+1).toString().padStart(2, '0') + '-' + 
                                   now.getDate().toString().padStart(2, '0') + ' ' + 
                                   now.getHours().toString().padStart(2, '0') + ':' + 
                                   now.getMinutes().toString().padStart(2, '0') + ':' + 
                                   now.getSeconds().toString().padStart(2, '0');
                    $tr.find('td:eq(8)').text(exportTime);
                    
                    // 更新操作按钮
                    var actionsHtml = `
                        <div class="table-actions">
                            <span class="table-action-btn danger cancel-export" data-id="${exportId}">
                                <i class="layui-icon layui-icon-stop"></i> 取消
                            </span>
                            <span class="table-action-btn view-details" data-id="${exportId}">
                                <i class="layui-icon layui-icon-eye"></i> 详情
                            </span>
                        </div>
                    `;
                    $tr.find('td:last-child').html(actionsHtml);
                    
                    layer.msg('导出任务已重新开始', {icon: 1});
                    
                    // 模拟进度更新
                    simulateExportProgress(exportId);
                }, 800);
            });

            // 刷新导出历史函数
            function refreshExportHistory(showMsg = true) {
                // 获取表格元素
                var $table = $('#exportHistoryTable');
                var $tbody = $table.find('tbody');
                
                // 显示加载动画
                layer.load(2);
                
                // 模拟数据加载延迟
                setTimeout(function(){
                    // 保存当前滚动位置
                    var scrollTop = $(window).scrollTop();
                    
                    // 清空表格内容，显示加载中提示
                    $tbody.html('<tr><td colspan="10" style="text-align: center; padding: 30px;"><i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop"></i> 正在加载导出历史...</td></tr>');
                    
                    // 模拟数据加载
                    setTimeout(function(){
                        // 恢复表格内容（实际应用中这里应该是从服务器获取最新数据）
                        $tbody.html(`
                            <tr>
                                <td>501</td>
                                <td>采集数据导出_202405101532</td>
                                <td>新闻网站采集</td>
                                <td>Excel</td>
                                <td>1,256 条</td>
                                <td class="file-size">2.4 MB</td>
                                <td><span class="status-tag status-success">导出成功</span></td>
                                <td>
                                    <div class="progress-container">
                                        <div class="progress-bar progress-success" style="width: 100%;"></div>
                                    </div>
                                </td>
                                <td>2024-05-10 15:32:47</td>
                                <td>
                                    <div class="table-actions">
                                        <span class="table-action-btn download-file" data-id="501">
                                            <i class="layui-icon layui-icon-download"></i> 下载
                                        </span>
                                        <span class="table-action-btn view-details" data-id="501">
                                            <i class="layui-icon layui-icon-eye"></i> 详情
                                        </span>
                                        <span class="table-action-btn danger delete-history" data-id="501">
                                            <i class="layui-icon layui-icon-delete"></i> 删除
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>500</td>
                                <td>电商数据_202405101420</td>
                                <td>电商价格监控</td>
                                <td>CSV</td>
                                <td>3,582 条</td>
                                <td class="file-size">1.8 MB</td>
                                <td><span class="status-tag status-success">导出成功</span></td>
                                <td>
                                    <div class="progress-container">
                                        <div class="progress-bar progress-success" style="width: 100%;"></div>
                                    </div>
                                </td>
                                <td>2024-05-10 14:20:15</td>
                                <td>
                                    <div class="table-actions">
                                        <span class="table-action-btn download-file" data-id="500">
                                            <i class="layui-icon layui-icon-download"></i> 下载
                                        </span>
                                        <span class="table-action-btn view-details" data-id="500">
                                            <i class="layui-icon layui-icon-eye"></i> 详情
                                        </span>
                                        <span class="table-action-btn danger delete-history" data-id="500">
                                            <i class="layui-icon layui-icon-delete"></i> 删除
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>499</td>
                                <td>社交媒体评论数据</td>
                                <td>社交媒体评论采集</td>
                                <td>JSON</td>
                                <td>5,247 条</td>
                                <td class="file-size">4.7 MB</td>
                                <td><span class="status-tag status-processing">处理中</span></td>
                                <td>
                                    <div class="progress-container">
                                        <div class="progress-bar progress-processing" style="width: 68%;"></div>
                                    </div>
                                </td>
                                <td>2024-05-10 15:10:32</td>
                                <td>
                                    <div class="table-actions">
                                        <span class="table-action-btn danger cancel-export" data-id="499">
                                            <i class="layui-icon layui-icon-stop"></i> 取消
                                        </span>
                                        <span class="table-action-btn view-details" data-id="499">
                                            <i class="layui-icon layui-icon-eye"></i> 详情
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>498</td>
                                <td>论坛帖子数据_20240510</td>
                                <td>论坛帖子采集</td>
                                <td>Excel</td>
                                <td>2,874 条</td>
                                <td class="file-size">0 MB</td>
                                <td><span class="status-tag status-failed">导出失败</span></td>
                                <td>
                                    <div class="progress-container">
                                        <div class="progress-bar progress-failed" style="width: 35%;"></div>
                                    </div>
                                </td>
                                <td>2024-05-10 13:45:22</td>
                                <td>
                                    <div class="table-actions">
                                        <span class="table-action-btn retry-export" data-id="498">
                                            <i class="layui-icon layui-icon-refresh"></i> 重试
                                        </span>
                                        <span class="table-action-btn view-details" data-id="498">
                                            <i class="layui-icon layui-icon-eye"></i> 详情
                                        </span>
                                        <span class="table-action-btn danger delete-history" data-id="498">
                                            <i class="layui-icon layui-icon-delete"></i> 删除
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        `);
                        
                        // 恢复滚动位置
                        $(window).scrollTop(scrollTop);
                        
                        // 关闭加载动画
                        layer.closeAll('loading');
                        
                        // 显示刷新成功提示
                        if(showMsg){
                            layer.msg('导出历史已更新', {icon: 1, time: 1500});
                        }
                        
                        // 为处理中的任务启动进度模拟
                        simulateExportProgress(499);
                    }, 800);
                }, 500);
            }

            // 模拟导出进度更新
            function simulateExportProgress(exportId) {
                var $progressBar = $(`.cancel-export[data-id="${exportId}"]`).closest('tr').find('.progress-bar');
                if(!$progressBar.length) return;
                
                var currentWidth = parseInt($progressBar.css('width'));
                var parentWidth = $progressBar.parent().width();
                var currentPercent = Math.round((currentWidth / parentWidth) * 100);
                
                if(currentPercent >= 100) return;
                
                // 每3-5秒更新一次进度
                var interval = setInterval(function(){
                    // 检查任务是否仍在处理中
                    var $statusTag = $(`.cancel-export[data-id="${exportId}"]`).closest('tr').find('.status-tag');
                    if(!$statusTag.hasClass('status-processing')) {
                        clearInterval(interval);
                        return;
                    }
                    
                    // 更新进度
                    var currentWidth = parseInt($progressBar.css('width'));
                    var parentWidth = $progressBar.parent().width();
                    var currentPercent = Math.round((currentWidth / parentWidth) * 100);
                    
                    // 随机增加1-5%的进度
                    var newPercent = currentPercent + Math.floor(Math.random() * 5) + 1;
                    if(newPercent > 100) newPercent = 100;
                    
                    $progressBar.css('width', newPercent + '%');
                    
                    // 如果进度达到100%，标记为已完成
                    if(newPercent === 100) {
                        clearInterval(interval);
                        
                        var $tr = $(`.cancel-export[data-id="${exportId}"]`).closest('tr');
                        $tr.find('.status-tag').removeClass('status-processing').addClass('status-success').text('导出成功');
                        $tr.find('.progress-bar').removeClass('progress-processing').addClass('progress-success');
                        
                        // 更新文件大小
                        var fileSize = (Math.random() * 5 + 1).toFixed(1) + ' MB';
                        $tr.find('.file-size').text(fileSize);
                        
                        // 更新操作按钮
                        var actionsHtml = `
                            <div class="table-actions">
                                <span class="table-action-btn download-file" data-id="${exportId}">
                                    <i class="layui-icon layui-icon-download"></i> 下载
                                </span>
                                <span class="table-action-btn view-details" data-id="${exportId}">
                                    <i class="layui-icon layui-icon-eye"></i> 详情
                                </span>
                                <span class="table-action-btn danger delete-history" data-id="${exportId}">
                                    <i class="layui-icon layui-icon-delete"></i> 删除
                                </span>
                            </div>
                        `;
                        $tr.find('td:last-child').html(actionsHtml);
                    }
                }, Math.floor(Math.random() * 2000) + 3000); // 3-5秒
            }
            
            // 页面加载完成后启动处理中任务的进度模拟
            $(function(){
                simulateExportProgress(499);
            });
        });
    </script>
</body>
</html>
    